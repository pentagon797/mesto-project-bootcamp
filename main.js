(()=>{"use strict";var e=document.querySelector(".element__grid"),t=document.querySelector(".profile__name"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__avatar"),r=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__edit-avatar-button"),u=document.querySelector(".popup_place"),i=document.querySelector(".popup_profile"),l=document.querySelector(".popup_picture"),d=document.querySelector(".popup_avatar"),s=document.querySelector(".popup_confirm-delete"),p=document.querySelector('.popup__save-buttton[name="popupSaveButtonProfile"]'),f=document.querySelector('.popup__save-buttton[name="popupSaveButtonAvatar"]'),m=document.querySelector('.popup__save-buttton[name="popupSaveButtonPlace"]'),v=document.forms.editPlaceForm,_=document.forms.editProfileForm,y=document.forms.editAvatarForm,b=document.forms.confirmDeleteForm,h=document.querySelector('.popup__input[name="editProfileName"]'),S=document.querySelector('.popup__input[name="editProfileDescription"]'),E=document.querySelector('.popup__input[name="editPlaceName"]'),k=document.querySelector('.popup__input[name="editPlaceURL"]'),L=document.querySelector('.popup__input[name="editAvatarURL"]'),q=document.querySelector("#element__template").content.querySelector(".element__item"),g=document.querySelector(".popup__image"),C=document.querySelector(".popup__figcaption");function x(e){"Escape"===e.key&&P(document.querySelector(".popup_opened"))}function A(e){e.classList.add("popup_opened"),document.addEventListener("keydown",x)}function P(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x)}function w(e,t){var n=e.target;(n.classList.contains("popup")||n.classList.contains("popup__close-buttton"))&&P(t)}function j(e){var t=e.button,n=e.text,o=e.disabled;t.disabled=!!o&&"disabled",t.textContent=n}var T={url:"https://mesto.nomoreparties.co/v1/wbf-cohort-5",headers:{"Content-Type":"application/json",authorization:"130e180b-af72-4664-9c14-e441c3c93356"}};function O(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}function B(){return fetch("".concat(T.url,"/users/me"),{method:"GET",headers:T.headers}).then(O)}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var I=null,N=null;function U(e,t){var n=q.cloneNode(!0),o=n.querySelector(".element__text"),r=n.querySelector(".element__image"),c=n.querySelector(".element__delete-button"),a=n.querySelector(".element__like-button"),u=n.querySelector(".element__like-countner");function i(e,t){return e.some((function(e){return e._id===t}))}function d(t,n){i(e.likes,n)?a.classList.add("element__like-button_active"):a.classList.remove("element__like-button_active"),u.textContent=t.length}return e.owner._id!==t&&c.remove(),e.owner._id===t&&c.addEventListener("click",(function(){b.removeEventListener("submit",N),function(e,t){N=function(n){var o;n.preventDefault(),(o=e,fetch("".concat(T.url,"/cards/").concat(o),{method:"DELETE",headers:T.headers}).then(O)).then((function(){t.remove(),P(s)})).catch((function(e){console.log(e)}))},b.addEventListener("submit",N),A(s)}(e._id,n)})),o.textContent=e.name,r.alt=e.name,r.src=e.link,r.addEventListener("click",(function(){C.textContent=o.textContent,g.alt=r.alt,g.src=r.src,A(l)})),a.addEventListener("click",(function(){var n,o;(n=e._id,o=i(e.likes,t),fetch("".concat(T.url,"/cards/likes/").concat(n),{method:o?"DELETE":"PUT",headers:T.headers}).then(O)).then((function(n){e.likes=n.likes,a.classList.toggle("element__like-button_active"),d(e.likes,t)}))})),d(e.likes,t),n}function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"append",o=arguments.length>3?arguments[3]:void 0,r=U(e,o);switch(n){case"append":t.append(r);break;case"prepend":t.prepend(r);break;case"before":t.before(r);break;case"after":t.after(r);break;default:console.error("Не валидное значние для параметра position")}}function M(e){return function(e){if(Array.isArray(e))return J(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function G(e,t,n){t?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled="disabled",e.classList.add(n.inactiveButtonClass))}a.addEventListener("click",(function(){A(d)})),o.addEventListener("click",(function(){A(d)})),r.addEventListener("click",(function(){A(i),h.value=t.textContent,S.value=n.textContent})),c.addEventListener("click",(function(){A(u)})),_.addEventListener("submit",(function(e){var o;e.preventDefault(),j({button:p,text:"Сохраняем...",disabled:!0}),(o={name:h.value,about:S.value},fetch("".concat(T.url,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify(o)}).then(O)).then((function(e){e.name=h.value,e.about=S.value,t.textContent=e.name,n.textContent=e.about,P(i)})).catch((function(e){console.log(e)})).finally((function(){j({button:p,text:"Сохранить",disabled:!1})}))})),v.addEventListener("submit",(function(t){var n;t.preventDefault(),j({button:m,text:"Создаем...",disabled:!0}),(n={name:E.value,link:k.value},fetch("".concat(T.url,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify(n)}).then(O)).then((function(n){F(n,e,"prepend",I),t.target.reset(),P(u)})).catch((function(e){console.log(e)})).finally((function(){j({button:m,text:"Создать",disabled:!1})}))})),y.addEventListener("submit",(function(e){var t;e.preventDefault(),j({button:f,text:"Обновляем...",disabled:!0}),(t={avatar:L.value},fetch("".concat(T.url,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify(t)}).then(O)).then((function(e){e.avatar=L.value,o.src=e.avatar,P(d)})).catch((function(e){console.log(e)})).finally((function(){j({button:f,text:"Сохранить",disabled:!1})}))})),i.addEventListener("click",(function(e){return w(e,i)})),u.addEventListener("click",(function(e){return w(e,u)})),l.addEventListener("click",(function(e){return w(e,l)})),d.addEventListener("click",(function(e){return w(e,d)})),s.addEventListener("click",(function(e){return w(e,s)})),function(e){M(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);G(o,e.checkValidity(),t),e.addEventListener("reset",(function(){G(o,!1,t)})),M(n).forEach((function(n){n.addEventListener("input",(function(r){G(o,e.checkValidity(),t),function(e,t,n){var o=e.validity.valid,r=t.querySelector("#".concat(e.name,"-error"));r&&(o?function(e,t,n){e.classList.remove(n.inputErrorClass),t.textContent=e.validationMessage}(e,r,n):function(e,t,n){e.classList.add(n.inputErrorClass),t.textContent=e.validationMessage}(e,r,n))}(n,e,t)}))}))}(t,e)}))}({formSelector:".popup__edit-form",inputSelector:".popup__input",submitButtonSelector:".popup__save-buttton",inactiveButtonClass:"popup__save-buttton_disabled",inputErrorClass:"popup__input_invalid"}),Promise.all([fetch("".concat(T.url,"/cards"),{method:"GET",headers:T.headers}).then(O),B()]).then((function(t){var n,o,r=(o=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(n,o)||function(e,t){if(e){if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],a=r[1];I=a._id,c.forEach((function(t){F(t,e,"append",I)}))})).catch((function(e){console.log(e)})),B().then((function(e){t.textContent=e.name,n.textContent=e.about,o.src=e.avatar})).catch((function(e){console.log(e)}))})();
(()=>{"use strict";var e=document.querySelector(".element__grid"),t=document.querySelector(".profile__name"),n=document.querySelector(".profile__description"),o=document.querySelector(".profile__avatar"),r=document.querySelector(".profile__edit-button"),c=document.querySelector(".profile__add-button"),a=document.querySelector(".profile__edit-avatar-button"),u=document.querySelector(".popup_place"),i=document.querySelector(".popup_profile"),l=document.querySelector(".popup_picture"),d=document.querySelector(".popup_avatar"),s=document.querySelector(".popup_confirm-delete"),p=document.querySelector('.popup__save-buttton[name="popupSaveButtonProfile"]'),f=document.querySelector('.popup__save-buttton[name="popupSaveButtonAvatar"]'),m=document.querySelector('.popup__save-buttton[name="popupSaveButtonPlace"]'),v=document.forms.editPlaceForm,y=document.forms.editProfileForm,_=document.forms.editAvatarForm,h=document.forms.confirmDeleteForm,b=document.querySelector('.popup__input[name="editProfileName"]'),S=document.querySelector('.popup__input[name="editProfileDescription"]'),g=document.querySelector('.popup__input[name="editPlaceName"]'),E=document.querySelector('.popup__input[name="editPlaceURL"]'),k=document.querySelector('.popup__input[name="editAvatarURL"]'),q=document.querySelector("#element__template").content.querySelector(".element__item"),L=document.querySelector(".popup__image"),C=document.querySelector(".popup__figcaption"),x={formSelector:".popup__edit-form",inputSelector:".popup__input",submitButtonSelector:".popup__save-buttton",inactiveButtonClass:"popup__save-buttton_disabled",inputErrorClass:"popup__input_invalid"};function A(e){"Escape"===e.key&&w(document.querySelector(".popup_opened"))}function P(e){e.classList.add("popup_opened"),document.addEventListener("keydown",A)}function w(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",A)}function j(e,t){var n=e.target;(n.classList.contains("popup")||n.classList.contains("popup__close-buttton"))&&w(t)}var T={url:"https://mesto.nomoreparties.co/v1/wbf-cohort-5",headers:{"Content-Type":"application/json",authorization:"130e180b-af72-4664-9c14-e441c3c93356"}};function O(e){return e.ok?e.json():e.json().then((function(e){return Promise.reject(e)}))}var B,D=null,I=null;function N(e,t){var n=q.cloneNode(!0),o=n.querySelector(".element__text"),r=n.querySelector(".element__image"),c=n.querySelector(".element__delete-button"),a=n.querySelector(".element__like-button"),u=n.querySelector(".element__like-countner");function i(e,t){return e.some((function(e){return e._id===t}))}function d(t,n){a.classList.toggle("element__like-button_active",i(e.likes,n)),u.textContent=t.length}return e.owner._id!==t&&c.remove(),e.owner._id===t&&c.addEventListener("click",(function(){D=e._id,h.removeEventListener("submit",I),function(e){I=function(t){var n;t.preventDefault(),(n=D,fetch("".concat(T.url,"/cards/").concat(n),{method:"DELETE",headers:T.headers}).then(O)).then((function(){e.remove(),w(s)})).catch((function(e){console.log(e)}))},h.addEventListener("submit",I),P(s)}(n)})),o.textContent=e.name,r.alt=e.name,r.src=e.link,r.addEventListener("click",(function(){C.textContent=o.textContent,L.alt=r.alt,L.src=r.src,P(l)})),a.addEventListener("click",(function(){var n,o;(n=e._id,o=i(e.likes,t),fetch("".concat(T.url,"/cards/likes/").concat(n),{method:o?"DELETE":"PUT",headers:T.headers}).then(O)).then((function(n){e.likes=n.likes,d(e.likes,t)})).catch((function(e){console.log(e)}))})),d(e.likes,t),n}function U(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"append",o=arguments.length>3?arguments[3]:void 0,r=N(e,o);switch(n){case"append":t.append(r);break;case"prepend":t.prepend(r);break;case"before":t.before(r);break;case"after":t.after(r);break;default:console.error("Не валидное значние для параметра position")}}function F(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function J(e,t,n){t?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled="disabled",e.classList.add(n.inactiveButtonClass))}function G(e){var t=e.button,n=e.disabled,o=e.config,r=e.text;J(t,n,o),t.textContent=r}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function R(e){var r=e.name,c=e.about,a=e.avatar;r&&(t.textContent=r),c&&(n.textContent=c),a&&(o.src=a)}a.addEventListener("click",(function(){P(d)})),o.addEventListener("click",(function(){P(d)})),r.addEventListener("click",(function(){P(i),b.value=t.textContent,S.value=n.textContent})),c.addEventListener("click",(function(){P(u)})),y.addEventListener("submit",(function(e){var t;e.preventDefault(),G({button:p,text:"Сохраняем...",disabled:!0,config:x}),(t={name:b.value,about:S.value},fetch("".concat(T.url,"/users/me"),{method:"PATCH",headers:T.headers,body:JSON.stringify(t)}).then(O)).then((function(e){R({name:e.name,about:e.about}),w(i)})).catch((function(e){console.log(e)})).finally((function(){G({button:p,text:"Сохранить",disabled:!1,config:x})}))})),v.addEventListener("submit",(function(t){var n;t.preventDefault(),G({button:m,text:"Создаем...",disabled:!0,config:x}),(n={name:g.value,link:E.value},fetch("".concat(T.url,"/cards"),{method:"POST",headers:T.headers,body:JSON.stringify(n)}).then(O)).then((function(n){U(n,e,"prepend",B),t.target.reset(),w(u)})).catch((function(e){console.log(e)})).finally((function(){G({button:m,text:"Создать",disabled:!1,config:x})}))})),_.addEventListener("submit",(function(e){var t;e.preventDefault(),G({button:f,text:"Обновляем...",disabled:!0,config:x}),(t={avatar:k.value},fetch("".concat(T.url,"/users/me/avatar"),{method:"PATCH",headers:T.headers,body:JSON.stringify(t)}).then(O)).then((function(e){R({avatar:e.avatar}),w(d)})).catch((function(e){console.log(e)})).finally((function(){G({button:f,text:"Сохранить",disabled:!1,config:x})}))})),i.addEventListener("click",(function(e){return j(e,i)})),u.addEventListener("click",(function(e){return j(e,u)})),l.addEventListener("click",(function(e){return j(e,l)})),d.addEventListener("click",(function(e){return j(e,d)})),s.addEventListener("click",(function(e){return j(e,s)})),Promise.all([fetch("".concat(T.url,"/cards"),{method:"GET",headers:T.headers}).then(O),fetch("".concat(T.url,"/users/me"),{method:"GET",headers:T.headers}).then(O)]).then((function(t){var n,o,r=(o=2,function(e){if(Array.isArray(e))return e}(n=t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(n,o)||function(e,t){if(e){if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],a=r[1];B=a._id,R(a),function(t){t.forEach((function(t){U(t,e,"append",B)}))}(c)})).catch((function(e){console.log(e)})),function(e){F(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);J(o,e.checkValidity(),t),e.addEventListener("reset",(function(){J(o,!1,t)})),F(n).forEach((function(n){n.addEventListener("input",(function(r){J(o,e.checkValidity(),t),function(e,t,n){var o=e.validity.valid,r=t.querySelector("#".concat(e.name,"-error"));r&&(o?function(e,t,n){e.classList.remove(n.inputErrorClass),t.textContent=e.validationMessage}(e,r,n):function(e,t,n){e.classList.add(n.inputErrorClass),t.textContent=e.validationMessage}(e,r,n))}(n,e,t)}))}))}(t,e)}))}(x)})();